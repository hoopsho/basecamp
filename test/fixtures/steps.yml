# frozen_string_literal: true

# Step fixtures â€” first 3 steps of each SOP for testing

# Steps for Past Customer Reactivation SOP
pcr_query_crm:
  sop: past_customer_reactivation
  position: 0
  name: 'Query CRM for past customers'
  step_type: 0
  config:
    query_type: 'crm_search'
    filters:
      status: 'past_customer'
      services: ['fertilizer', 'weed_control']
      signed_up_for_season: false
  llm_tier: 0
  max_llm_tier: 0
  on_success: 'next'
  on_failure: 'escalate_tier'
  max_retries: 3
  timeout_seconds: 30
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>

pcr_draft_email:
  sop: past_customer_reactivation
  position: 1
  name: 'Draft reactivation email'
  step_type: 3
  config:
    prompt_template: 'You are a friendly marketing assistant for Eighty Eight Services LLC (dba Snowmass), a lawn care and snow removal company in the Twin Cities, MN. Draft a personalized reactivation email for {{customer_name}} who previously used our {{previous_service}} service.'
    output_format: 'email'
  llm_tier: 1
  max_llm_tier: 2
  on_success: 'next'
  on_failure: 'escalate_tier'
  max_retries: 3
  timeout_seconds: 60
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>

pcr_submit_approval:
  sop: past_customer_reactivation
  position: 2
  name: 'Submit draft for approval'
  step_type: 7
  config:
    prompt: 'Review this reactivation email draft for {{customer_name}}:'
    options: ['Send as-is', 'Edit first', "Don't send"]
    channel: '#marketing'
  llm_tier: 0
  max_llm_tier: 0
  on_success: 'next'
  on_failure: 'fail'
  on_uncertain: 'fail'
  max_retries: 1
  timeout_seconds: 7200
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>

# Steps for New Lead Response SOP
nlr_classify_email:
  sop: new_lead_response
  position: 0
  name: 'Classify incoming email'
  step_type: 2
  config:
    prompt_template: "Classify this incoming email into one of these categories: new_lead, existing_customer, complaint, scheduling, spam.\n\nFrom: {{email_from}}\nSubject: {{email_subject}}\nBody: {{email_body}}"
    categories: ['new_lead', 'existing_customer', 'complaint', 'scheduling', 'spam']
  llm_tier: 1
  max_llm_tier: 2
  on_success: 'next'
  on_failure: 'escalate_tier'
  max_retries: 3
  timeout_seconds: 45
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>

nlr_filter_spam:
  sop: new_lead_response
  position: 1
  name: 'Filter spam and route'
  step_type: 0
  config:
    query_type: 'branch'
    branch_field: 'step_0_result'
    branches:
      spam: 'complete'
      complaint: 'escalate'
      existing_customer: 'escalate'
    default: 'next'
  llm_tier: 0
  max_llm_tier: 0
  on_success: 'next'
  on_failure: 'complete'
  max_retries: 1
  timeout_seconds: 15
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>

nlr_draft_ack:
  sop: new_lead_response
  position: 2
  name: 'Draft acknowledgment email'
  step_type: 3
  config:
    prompt_template: 'You are a friendly customer service representative for Eighty Eight Services LLC (dba Snowmass). Draft a brief acknowledgment email for a new lead named {{customer_name}} who reached out about our services.'
    output_format: 'email'
  llm_tier: 1
  max_llm_tier: 2
  on_success: 'next'
  on_failure: 'escalate_tier'
  max_retries: 3
  timeout_seconds: 60
  created_at: <%= Time.current %>
  updated_at: <%= Time.current %>
