<!DOCTYPE html>
<html lang="en" data-controller="theme">
  <head>
    <title><%= content_for(:title) || "Admin - SOP Engine" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <%# Prevent flash of unstyled content for dark mode %>
    <script>
      (function() {
        const theme = localStorage.getItem('theme') || 'system';
        const isDark = theme === 'dark' ||
                       (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
        if (isDark) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 antialiased">
    <div class="min-h-screen flex">
      <%# Sidebar - hidden on mobile, toggleable %>
      <aside data-controller="toggle"
             data-toggle-active-class="hidden"
             data-toggle-target="content"
             class="hidden lg:block fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 lg:static lg:translate-x-0">
        <%= render 'shared/sidebar' %>
      </aside>

      <%# Mobile sidebar backdrop %>
      <div data-toggle-target="content"
           data-action="click->toggle#toggle"
           class="hidden lg:hidden fixed inset-0 z-40 bg-gray-900/50 dark:bg-gray-950/75"></div>

      <%# Main content area %>
      <div class="flex-1 flex flex-col min-w-0">
        <%# Header with mobile menu button %>
        <header class="lg:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-30">
          <div class="flex items-center justify-between px-4 py-3">
            <%= link_to admin_root_path, class: "text-lg font-bold text-primary-600 dark:text-primary-400" do %>
              SOP Engine
            <% end %>
            <button data-action="click->toggle#toggle" class="p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
          </div>
        </header>

        <%= render 'shared/admin_header' %>

        <%# Flash messages %>
        <%= render 'shared/flash' %>

        <%# Main content %>
        <main class="flex-1 px-4 sm:px-6 lg:px-8 py-8">
          <%= yield %>
        </main>

        <%# Footer %>
        <footer class="border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 sm:px-6 lg:px-8 py-4">
          <p class="text-sm text-gray-500 dark:text-gray-400">
            SOP Engine v0.1 â€” Eighty Eight Services LLC
          </p>
        </footer>
      </div>
    </div>
  </body>
</html>
