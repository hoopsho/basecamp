<!-- app/views/admin/agents/index.html.erb -->
<!-- Agents list with status badges, table display, and pause/resume actions -->

<div class="space-y-6">
  <!-- Page header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Agents</h1>
      <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Manage AI worker roles and their configurations</p>
    </div>
  </div>

  <!-- Agents table -->
  <div class="bg-white dark:bg-gray-800 shadow-sm rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Name
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Status
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Slack Channel
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Loop Interval
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Active Tasks
            </th>
            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
          <% @agents.each do |agent| %>
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
              <!-- Name -->
              <td class="px-6 py-4 whitespace-nowrap">
                <%= link_to admin_agent_path(agent), class: "flex items-center gap-3 group" do %>
                  <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center">
                    <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <div>
                    <div class="text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:text-primary-600 dark:group-hover:text-primary-400">
                      <%= agent.name %>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      <%= agent.slug %>
                    </div>
                  </div>
                <% end %>
              </td>

              <!-- Status -->
              <td class="px-6 py-4 whitespace-nowrap">
                <% status_classes = case agent.status
                   when 'active'
                     'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'
                   when 'paused'
                     'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400'
                   when 'disabled'
                     'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400'
                   end %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= status_classes %>">
                  <span class="w-1.5 h-1.5 rounded-full mr-1.5 <%= agent.active? ? 'bg-green-500' : (agent.paused? ? 'bg-yellow-500' : 'bg-gray-500') %>"></span>
                  <%= agent.status.capitalize %>
                </span>
              </td>

              <!-- Slack Channel -->
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-300">
                  <svg class="w-4 h-4 text-gray-400 dark:text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/>
                  </svg>
                  <span class="font-mono text-xs"><%= agent.slack_channel %></span>
                </div>
              </td>

              <!-- Loop Interval -->
              <td class="px-6 py-4 whitespace-nowrap">
                <% if agent.loop_interval_minutes.present? %>
                  <div class="flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-300">
                    <svg class="w-4 h-4 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <%= agent.loop_interval_minutes %> min
                  </div>
                <% else %>
                  <span class="text-sm text-gray-400 dark:text-gray-500">â€”</span>
                <% end %>
              </td>

              <!-- Active Tasks -->
              <td class="px-6 py-4 whitespace-nowrap">
                <% active_count = agent.tasks.active.count %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-sm font-medium <%= active_count > 0 ? 'bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300' : 'text-gray-500 dark:text-gray-400' %>">
                  <%= active_count %>
                </span>
              </td>

              <!-- Actions -->
              <td class="px-6 py-4 whitespace-nowrap text-right">
                <div class="flex items-center justify-end gap-2">
                  <%= link_to admin_agent_path(agent), class: "text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors", title: "View details" do %>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <span class="sr-only">View</span>
                  <% end %>

                  <% if policy(agent).edit? %>
                    <%= link_to edit_admin_agent_path(agent), class: "text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors", title: "Edit" do %>
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"/>
                      </svg>
                      <span class="sr-only">Edit</span>
                    <% end %>
                  <% end %>

                  <% if agent.active? && policy(agent).pause? %>
                    <%= button_to pause_admin_agent_path(agent), method: :post, class: "text-gray-400 hover:text-yellow-600 dark:hover:text-yellow-400 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors", title: "Pause agent", data: { turbo_confirm: "Pause this agent?" } do %>
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 5.25v13.5m-7.5-13.5v13.5"/>
                      </svg>
                      <span class="sr-only">Pause</span>
                    <% end %>
                  <% elsif agent.paused? && policy(agent).resume? %>
                    <%= button_to resume_admin_agent_path(agent), method: :post, class: "text-gray-400 hover:text-green-600 dark:hover:text-green-400 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors", title: "Resume agent" do %>
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"/>
                      </svg>
                      <span class="sr-only">Resume</span>
                    <% end %>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <% if @agents.empty? %>
      <div class="px-6 py-12 text-center">
        <div class="mx-auto w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4">
          <svg class="w-6 h-6 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/>
          </svg>
        </div>
        <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100">No agents</h3>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Agents are configured via seeds or console.</p>
      </div>
    <% end %>
  </div>
</div>
